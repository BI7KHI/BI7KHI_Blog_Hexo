---
title: 【网络运维】腾讯轻量云服务器压榨计划
date: 2025-09-20 12:36:04
tags: [服务器,web开发,Minecraft,运维,远程桌面,DNS,CloudFlare]
categories: [技术]
cover: https://cloudcache.tencent-cloud.com/open_proj/proj_qcloud_v2/tc-console/tea-static-lighthouse/src/styles/slice/Ubuntu.svg
---
## 为什么最后购买了腾讯轻量云服务器，拿来做甚

起初只是想搭建一个Minecraft服务器玩玩，后面服务器其实占用方面不算太紧张，后面服务就越加越多:

* Minecraft Fabric 1.21.1服务器端
* RustDesk 私人开源远程桌面服务
* 2025业余无线电新版题库答题与模拟程序

价格嘛，70RMB一年，配置如下

* CPU - 4核 内存 - 4GB
* 系统盘 - SSD云硬盘 40GB
* 流量包 - 300GB/月（带宽 3Mbps）
* 公网IP与IPV6 Enable

## 服务器占用现状

服务器操作系统:**Ubuntu Server 24.04 LTS 64bit**
服务器面板:**宝塔企业版**（感谢BA7IEI赠送的白嫖劵，不然就是1Panel了）

服务器七日平均负载
![Load-AVG](/images/腾讯轻量云服务器压榨计划/平均负载.png "Load-AVG")

服务器RAM
![RAM](/images/腾讯轻量云服务器压榨计划/RAM.png "RAM")

RAM、CPU和负载大头:java
网络IO大头:hbbr hbbs容器 （Rustdesk）、

## 购买服务器后的小折腾

个人还是喜欢使用的SSH远程登录进行服务器的各种操作，以面板辅助管理服务器内容
刚购买服务器腾讯云默认安装的系统是腾讯自己的**OpencCloudOS**，很多命令其实和我先前用的最多的Ubuntu差别很大，在完成Minecraft的JAVA环境安装就出现了问题
![OPENCLOS](https://www.opencloudos.org/assets/logo-C2hewUFH.png "OPENCLOS")

在新系统的拷打两天之后，最后还是选择重装Ubuntu。~~回来了，熟悉的感觉回来了~~而后服务器的相关服务部署顺利很多

## Minecraft

使用的是Fabric服务器开服方式，Minecraft版本号1.21.1

主要MOD&插件安装列表

* Worldedit CUI
* Yes Steve Model(YSM)
* 极简血量显示
* Voicechat服务器内语音
* 越肩视角

启动服务器前需要先同意**EULA**

```
#By changing the setting below to TRUE you are indicating your agreement to our EULA (https://aka.ms/MinecraftEULA).
#Thu Jul 10 15:13:29 UTC 2025
eula=TRUE

```

服务器启动脚本 start.sh

```
#!/usr/bin/env sh

java -Xms4096M -Xmx4096M -jar fabric-server-mc.1.21.1-loader.0.16.14-launcher.1.0.3.jar nogui
```

后面安装mod之类的只需按着文档和说明操作就行了

### ~~首次的部署尝试MCSManager(弃用)~~

第一次部署想要一个更加方便管理的，专门的Minecraft服务器管理器，后面就放弃了，用的是比较原始的方式，直接在服务器上启动脚本，然后用screen保持运行。减小服务器占用和避免一些神必bug。~~MCSManager对于多个Minecraft服务器管理有奇效，但是如果是对这种仅运行一个服务器的应用来说有点大材小用。~~

### 服务器建筑&人物好图分享(持续更新中)

![mainpage](/images/background_mainpage.png)

黍黍黍黍黍黍黍黍黍黍黍黍黍黍黍黍黍黍黍黍黍黍黍黍黍黍黍黍黍黍黍黍黍黍黍黍黍

### 服务器客户端&整合包获取🐧QQ裙

![qq](/images/腾讯轻量云服务器压榨计划/qq.jpg "qq")

## Rustdesk远程桌面

项目官网:
[RustDesk：开源远程桌面与自建服务器解决方案](https://rustdesk.com/zh-cn/)
项目文档:
[RustDesk 文档](https://rustdesk.com/docs/zh-cn/)

#### 部署指令(Docker)

```
sudo docker image pull rustdesk/rustdesk-server
sudo docker run --name hbbs -v ./data:/root -td --net=host --restart unless-stopped rustdesk/rustdesk-server hbbs
sudo docker run --name hbbr -v ./data:/root -td --net=host --restart unless-stopped rustdesk/rustdesk-server hbbr
```

#### 需要打开和放行的端口

* hbbs:

  * 21114 (TCP): 用于网页控制台，仅在 Pro 版本中可用。
  * 21115 (TCP): 用于 NAT 类型测试。
  * 21116 (TCP/UDP): 请注意 21116 应该同时为 TCP 和 UDP 启用。 21116/UDP 用于 ID 注册和心跳服务。21116/TCP 用于 TCP 打洞和连接服务。
  * 21118 (TCP): 用于支持网页客户端。
* hbbr:

  * 21117 (TCP): 用于中继服务。
  * 21119 (TCP): 用于支持网页客户端。

### 注意：

**需要在Ubuntu和云服务器面板都要放行端口，否则将无法连接**
![tenfw](/images/腾讯轻量云服务器压榨计划/image1.png "tenfw")
![btfw](/images/腾讯轻量云服务器压榨计划/image2.png "btfw")

#### API KEY存储位置

/Rustdesk/data/id_ed25519.pub

### 客户端配置

来到客户端设置界面，先解锁**解锁网络设置**
![rustdesk](/images/腾讯轻量云服务器压榨计划/image.png "rustdesk")

**需要在客户端设置中添加服务器地址和API KEY**其它留空

* ID服务器: 服务器IP:21116
* API KEY: id_ed25519.pub中的值

退出至主页可以看到左下角**就绪**标志变为绿色
然后就可以愉快地连接了

### 占用带宽

以1080P地远程流为例，实际占用带宽大约200kbps 帧率在20-30fps左右抖动(能用就行)

## 业余无线电新题库答题部署

项目地址：[BI7KHI/HAM_OperationTechnicalVerification: 业余无线电台操作技术能力验证题库](https://github.com/BI7KHI/HAM_OperationTechnicalVerification)

服务启动脚本**deploy.sh**

```#!/bin/bash

# HAM操作技术验证系统部署脚本
# 适用于Linux服务器部署

echo "开始部署HAM操作技术验证系统..."
source venv/bin/activate
python app.py
echo ""
echo "应用应该在以下地址可访问:"
echo "本地访问: http://localhost:5000"
echo "网络访问: http://$(hostname -I | awk '{print $1}'):5000"
echo "外网访问: http://您的服务器IP:5000"
```

**需要创建虚拟Python环境并激活**

## 服务器反向代理与DNS配置(如何使用顶级域名，如何配置DNS记录)

服务器目前部署了三个反向代理

* Nginx版本 1.26.3
* rd.bi7khi.xyz 远程桌面服务
* mc.bi7khi.xyz Minecraft服务
* hamtest.bi7khi.xyz 新题库答题服务

以hamtest.bi7khi.xyz为例

### Nginx主配置文件(宝塔面板，SSL证书部署，TrustAsia DV TLS RSA CA 2025)

```nginx
proxy_cache_path /www/wwwroot/hamtest.bi7khi.xyz/proxy_cache_dir levels=1:2 keys_zone=hamtest_bi7khi_xyz_cache:20m inactive=1d max_size=5g;

server {
    listen 80;
  
    listen 443 quic;
    listen 443 ssl;
    listen [::]:80;
  
    listen [::]:443 quic;
    listen [::]:443 ssl ;
  
    http2 on;
    server_name hamtest.bi7khi.xyz;
    index index.php index.html index.htm default.php default.htm default.html;
    root /www/wwwroot/hamtest.bi7khi.xyz;

    #CERT-APPLY-CHECK--START
    # 用于SSL证书申请时的文件验证相关配置 -- 请勿删除
    include /www/server/panel/vhost/nginx/well-known/hamtest.bi7khi.xyz.conf;
    #CERT-APPLY-CHECK--END

    #SSL-START SSL相关配置，请勿删除或修改下一行带注释的404规则
    #error_page 404/404.html;    #HTTP_TO_HTTPS_START
    set $isRedcert 1;
    if ( $uri ~ /\.well-known/ ) {
        set $isRedcert 1;
    }
    if ($isRedcert != 1) {
        rewrite ^(/.*)$ https://$host$1 permanent;
    }
    #HTTP_TO_HTTPS_END
    ssl_certificate    /www/server/panel/vhost/cert/hamtest.bi7khi.xyz/fullchain.pem;
    ssl_certificate_key    /www/server/panel/vhost/cert/hamtest.bi7khi.xyz/privkey.pem;
    ssl_protocols TLSv1.1 TLSv1.2 TLSv1.3;
    ssl_ciphers EECDH+CHACHA20:EECDH+CHACHA20-draft:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5;
    ssl_prefer_server_ciphers on;
    ssl_session_cache shared:SSL:10m;
    ssl_session_timeout 10m;
    add_header Strict-Transport-Security "max-age=31536000";
    error_page 497  https://$host$request_uri;
    #SSL-END
    #REDIRECT START
    #REDIRECT END
    #ERROR-PAGE-START  错误页配置，可以注释、删除或修改
    #error_page 404 /404.html;
    #error_page 502 /502.html;
    #ERROR-PAGE-END
    #PHP-INFO-START  PHP引用配置，可以注释或修改
    include enable-php-00.conf;
    #PHP-INFO-END
    #IP-RESTRICT-START 限制访问ip的配置，IP黑白名单
    #IP-RESTRICT-END
    #BASICAUTH START
    #BASICAUTH END
    #SUB_FILTER START
    #SUB_FILTER END
    #GZIP START
    #GZIP END
    #GLOBAL-CACHE START
    #GLOBAL-CACHE END
    #WEBSOCKET-SUPPORT START
    proxy_http_version 1.1;
      proxy_set_header Upgrade $http_upgrade;
      proxy_set_header Connection $connection_upgrade;
    #WEBSOCKET-SUPPORT END

    #PROXY-CONF-START
    location ^~ / {
      proxy_pass http://127.0.0.1:5000;
      proxy_set_header Host $http_host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Real-Port $remote_port;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header X-Forwarded-Proto $scheme;
      proxy_set_header X-Forwarded-Host $host;
      proxy_set_header X-Forwarded-Port $server_port;
      proxy_set_header REMOTE-HOST $remote_addr;
      proxy_connect_timeout 60s;
    proxy_send_timeout 600s;
    proxy_read_timeout 600s;
      proxy_http_version 1.1;
      proxy_set_header Upgrade $http_upgrade;
      proxy_set_header Connection $connection_upgrade;
    }
  
    #PROXY-CONF-END
    #SERVER-BLOCK START
    #SERVER-BLOCK END
    #禁止访问的文件或目录
    location ~ ^/(\.user.ini|\.htaccess|\.git|\.env|\.svn|\.project|LICENSE|README.md)
    {
        return 404;
    }

    #一键申请SSL证书验证目录相关设置
    location /.well-known{
        allow all;
    }

    #禁止在证书验证目录放入敏感文件
    if ( $uri ~ "^/\.well-known/.*\.(php|jsp|py|js|css|lua|ts|go|zip|tar\.gz|rar|7z|sql|bak)$" ) {
        return 403;
    }

    #LOG START
  
access_log  /www/wwwlogs/hamtest.bi7khi.xyz.log;
    error_log  /www/wwwlogs/hamtest.bi7khi.xyz.error.log;
    #LOG END

    #Monitor-Config-Start 网站监控报表日志发送配置
    access_log syslog:server=unix:/tmp/bt-monitor.sock,nohostname,tag=13__access monitor;
    error_log syslog:server=unix:/tmp/bt-monitor.sock,nohostname,tag=13__error;
    #Monitor-Config-End
}
```

### CLOUDFLARE DNS记录值

![cf](/images/腾讯轻量云服务器压榨计划/image4.png "cf")

A记录指向服务器IP
**一般应用后实际上不会立即生效，一般需要几个小时，最长可能需要48hr**
**服务器地反向代理和DNS配置都需要生效，才能正常访问**

#### 关于SRV记录

**SRV记录用于指定服务的位置和端口，用于服务发现。需要A记录辅助才能使用**

#### 在腾讯云如何选择DNS服务商以及如何配置域名

使用第三方DNS服务商后并不需要在腾讯云服务器上配置DNS记录，只需要在第三方DNS服务商的管理界面配置即可。
腾讯云控制台->我的域名->管理->DNS解析->修改DNS服务器
通过MFA认证后选择DNS服务商为其它
(以CloudFlare为例)

```
DNS 服务器
braden.ns.cloudflare.com
bonnie.ns.cloudflare.com
```

然后等待生效即可

---

最后修改日期: 2025-09-20 14:35:27
~~台风天，睡午觉去咯~~
